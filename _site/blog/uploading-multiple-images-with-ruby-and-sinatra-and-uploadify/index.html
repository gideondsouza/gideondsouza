<!DOCTYPE HTML>
<html lang="en-US">
<head>

    <meta charset="UTF-8">

    <title>Uploading multiple images with Ruby, Sinatra and Uploadify.</title>

    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="Jekyll v3.1.2">

    <link rel="canonical" href="/blog/uploading-multiple-images-with-ruby-and-sinatra-and-uploadify/" />
    <link rel="alternate" type="application/atom+xml" title="Coded with <3 — Feed" href="/blog/feed.atom" />

    <link href='https://fonts.googleapis.com/css?family=Fenix|Montserrat|Playfair+Display:700italic,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!-- <link href="/css/syntax.css" rel="stylesheet"> -->

    <!--[if lt IE 9]>
    <script src="/js/html5shiv.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <div class="page-wrap">


<section class="main-header regular">

    <div class="vertical-container">

    	<div class="wrapper clearfix">

	        <header>
	        	<a href="/">
		            <h1 id="main-title">Gideon Dsouza</h1>
		            <h2 id="main-subtitle">Coded with Love</h2>
	        	</a>
	        </header>

	        <nav id="main-nav" role="navigation">
				<a href="/about/" class="">About</a>
				<a href="/blog/" class="">Blog</a>
        <a href="http://stackoverflow.com/cv/gideondsouza"
            class="" target="_blank">Resume</a>
			</nav>
      <!-- <section><a href="#">abc</a></section> -->
		</div>

    </div>

</section>


<article class="main-content">

    <div class="wrapper">

        <header class="section-header">
            <h1 class="section-title">Uploading multiple images with Ruby, Sinatra and Uploadify.</h1>
            <span class="section-subtitle"><time datetime="2016-05-31 00:00:00 +0530" pubdate>31 May 2016</time>, <a class="tag_list_link" href="/tag/ruby">ruby</a>, <a class="tag_list_link" href="/tag/web-dev">web-dev</a>, <a class="tag_list_link" href="/tag/sinatra">sinatra</a>, <a class="tag_list_link" href="/tag/uploadify">uploadify</a></span>
        </header>

        <section class="post-content">

        	<p>This is the finished product:
<img src="http://i.imgur.com/jUwZVYx.png" alt="screenshot example" /></p>

<p>I’m continuing off from this article where I describe how to just <a href="http://www.gideondsouza.com/blog/uploading-images-with-ruby-and-sinatra/">upload files in a Sinatra application</a>.</p>

<p>We’ll move forward to now uploding multiple files. If you’ve been searching for this you may have come across <a href="www.uploadify.com">uploadify.com</a></p>

<p>It’s a flash/jquery based plugin. I’ve used it in ancient times. Yes you may still flash to gracefully degrade if the browser isn’t all that new. However, they have a paid html5 version of their library. <strong>My code uses the free library.</strong></p>

<p><strong>Setup</strong> :</p>

<ul>
  <li>
    <p>Install shotgun so you don’t have to reload your Sinatra app everytime you change/debug</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>  $ gem install shotgun
</code></pre>
    </div>
  </li>
  <li>Download the free uploadify plugin : <a href="http://www.uploadify.com/download/">http://www.uploadify.com/download/</a></li>
  <li>Extract the uploadify zip into a <em>/public</em> folder. Inside it put an <em>/img</em> folder, uplodify expects the cancel button image to come out of here.</li>
</ul>

<p>Your directory should look like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[gideon@gideon-fedora image_manager]$ tree
.
├── img_mgr.rb
├── public
│   ├── img
│   │   └── uploadify-cancel.png
│   ├── jquery.uploadify.js
│   ├── jquery.uploadify.min.js
│   ├── license.txt
│   ├── uploadify.css
│   └── uploadify.swf
└── views
    └── form_multiple.erb

3 directories, 8 files
</code></pre>
</div>

<p>All our meat is in two files <em>img_mgr.rb</em> and <em>form_multiple.erb</em></p>

<p>Here is our sinatra app:</p>

<!-- <script src="https://gist.github.com/gideondsouza/59f1d9ccb2551d0c06e8c47351a063f8.js"></script> -->
<p><a href="https://gist.github.com/gideondsouza/59f1d9ccb2551d0c06e8c47351a063f8">img_mgr.rb</a> :</p>

<div class="highlighter-rouge"><pre class="highlight"><code>require 'sinatra'

get '/' do
  erb :form_multiple
end

post '/upload' do
#this method will get as ajax call for every file uploaded
  @filename = params[:Filename]
  file = params[:Filedata][:tempfile]

  File.open("./public/#{@filename}", 'wb') do |f|
    f.write(file.read)
  end

  #return filename as the response, the file we just wrote.
  return @filename
end
</code></pre>
</div>

<p>The home page route <em>’/’</em> serves the <em>form_multiple.erb</em> file. This will use uploadify to set itself up. It will make requests to the <em>‘/upload’</em> route. In here we get the filename from <em>params[:Filename]</em> and the file object from <em>file = params[:Filedata][:tempfile]</em>. If you want to know how I figured this out, I simple wrote in <em>puts params</em>. This gets printed into the console and you can check out the object yourself then. I write the file into the <em>/public</em> folder. It can be served them from the root of the wherever this is hosted.</p>

<p>The view looks like this:</p>

<p><a href="https://gist.github.com/gideondsouza/1367104cfc8a83c4b5c924fe467d6032#file-form_multiple-erb">form_multiple.erb</a> :
<!-- <script src="https://gist.github.com/gideondsouza/1367104cfc8a83c4b5c924fe467d6032.js"></script> --></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>Image Upload<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"uploadify.css"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"http://code.jquery.com/jquery-1.7.2.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"jquery.uploadify.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>

        <span class="nt">&lt;h1&gt;</span>Upload Images<span class="nt">&lt;/h1&gt;</span>

        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file_upload"</span> <span class="na">id=</span><span class="s">"file_upload"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;script&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">(</span><span class="s1">'#file_upload'</span><span class="p">).</span><span class="nx">uploadify</span><span class="p">({</span>
              <span class="s1">'swf'</span>      <span class="p">:</span> <span class="s1">'uploadify.swf'</span><span class="p">,</span>
              <span class="s1">'uploader'</span> <span class="p">:</span> <span class="s1">'/upload'</span><span class="p">,</span>
              <span class="s1">'onUploadSuccess'</span> <span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">$</span><span class="p">(</span><span class="s2">"#images"</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">"&lt;img src='/"</span> <span class="o">+</span> <span class="nx">data</span> <span class="o">+</span> <span class="s2">"' height='100px'/&gt;"</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">});</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"images"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Uploaded images here:<span class="nt">&lt;/strong&gt;&lt;br</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<p>If you notice in our server(sinatra) app we return the filename as a response, this is what the uploadify plugin will give us in the <em>onUploadSuccess</em> handler. All we do it append an image tag into our predefined div.</p>

<p>To execute all you need to do is :</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  $ shotgun img_mgr.rb
</code></pre>
</div>

<p>If you need the whole thing in a nice downloadable package, <a href="/assets/image_manager.zip">here it is</a>.</p>

<p>Feel free to post any questions or comments.</p>


            <div class="post-nav">

                <span class="section-subtitle">Share on <a href="https://twitter.com/home?status=Uploading multiple images with Ruby, Sinatra and Uploadify.+www.gideondsouza.com/blog/uploading-multiple-images-with-ruby-and-sinatra-and-uploadify/" target="_blank">Twitter</a>, <a href="https://www.facebook.com/share.php?u=www.gideondsouza.com/blog/uploading-multiple-images-with-ruby-and-sinatra-and-uploadify/&amp;title=Uploading multiple images with Ruby, Sinatra and Uploadify." target="_blank">Facebook</a>, <a href="https://plus.google.com/share?url=www.gideondsouza.com/blog/uploading-multiple-images-with-ruby-and-sinatra-and-uploadify/" target="_blank">Google+</a></span><br>

				
                	<a href="/blog/uploading-images-with-ruby-and-sinatra/" class="button">Prev</a>
				
				

            </div>
            <!-- disqus comments -->
            <div id="disqus_thread"></div>
            <script>
            /**
            * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
            * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
            */
            /*
            var disqus_config = function () {
            this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };
            */
            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//gideond.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">
              comments powered by Disqus.</a></noscript>
        </section>

    </div>

</article>

    </div>

<footer class="main-footer">

    <div class="vertical-container">

        <div class="wrapper">

            <p class="copy">&copy; Gideon Dsouza - All Rights Reserved</p>

            <ul class="social">
                <li><a href="https://twitter.com/thegiddygeek">Twitter</a></li>
                <li><a href="https://github.com/gideondsouza">GitHub</a></li>
                <!-- <li><a href="#">LinkedIn</a></li> -->
            </ul>

        </div>

    </div>

</footer>


<!-- Google analytics script -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-26524399-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>

